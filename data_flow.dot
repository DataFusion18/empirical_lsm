digraph data_flow {

    plots -> summary_data;
    plots -> metrics [style=dashed];

    metrics -> obs_flux_test;
    metrics -> model_pred;
    summary_data -> model_pred;

    model_pred -> fitted_model;
    model_pred -> obs_met_test;

    fitted_model -> model;
    fitted_model -> obs_flux_train;
    fitted_model -> obs_met_train;
    fitted_model -> site_data [style=dashed];

    model -> structure;
    model -> parameters;
    parameters -> site_data;
    parameters -> literature;
    parameters -> structure;
    structure -> "?";

    // obs_flux_test -> obs_flux_data;
    // obs_met_test -> obs_met_data;
    // obs_flux_train -> obs_flux_data;
    // obs_met_train -> obs_met_data;

    obs_flux_test -> tt_selection;
    obs_met_test -> tt_selection;
    obs_flux_train -> tt_selection;
    obs_met_train -> tt_selection;

    tt_selection -> obs_met_data;
    tt_selection -> obs_flux_data;

    site_data -> gridded_data;

    cache -> model_pred [color=red];
    cache -> fitted_model [color=red];
    cache -> metrics [color=red];

    store_data -> fitted_model [color=blue];
    store_data -> tt_selection [color=blue];
    store_data -> metrics [color=blue];

    plots;
    metrics;
    summary_data   [label="summary data"];
    model_pred     [label="model predictions"];
    fitted_model   [label="fitted model"];
    model;
    structure;
    literature     [label=literature, shape=folder];
    parameters;
    site_data      [label="site data"];
    gridded_data   [label="gridded data", shape=folder];
    obs_flux_data  [label="obs flux data", shape=folder];
    obs_flux_test  [label="obs flux\ntest set", shape=note];
    obs_flux_train [label="obs flux\ntrain set", shape=note];
    obs_met_data   [label="obs met data", shape=folder];
    obs_met_test   [label="obs met\ntest set", shape=note];
    obs_met_train  [label="obs met\ntrain set", shape=note];
    tt_selection   [label="train/test\nselection process"];
    cache          [label="cache data for\nefficiency", shape=box, color=red, fontcolor=red];
    store_data     [label="store (meta)data\nfor reference", shape=box, color=blue, fontcolor=blue];
}
